{
    "auth_key": "{{process.env.ANTIGRAVITY_WEBHOOK_SECRET}}",
    "evolved_prompt": "You are a SOTA Hybrid Transformer Stock Prediction Agent. Analyze market state using Self-Attention mechanisms on RSI, MACD, and Volatility features. Integrate multi-modal sentiment if available.",
    "optimized_params": {
        "model_code": "import { CandlestickData, TechnicalIndicators } from '@/types/stock';\nimport { calculateIndicators } from './indicators';\n\n// --- Evolved System Types ---\n\ninterface TransformerAttentionWeight {\n    feature: string;\n    weight: number;\n}\n\ninterface MarketStateVector {\n    rsi: number;\n    macdHistogram: number;\n    volatility: number;\n    trendStrength: number;\n    volumeFlow: number;\n}\n\nexport interface PredictionResult {\n    action: 'BUY' | 'SELL' | 'HOLD';\n    confidence: number;\n    targetPrice: number;\n    reasoning: string;\n}\n\n// --- SOTA-Inspired Hybrid Transformer Strategy ---\n\nexport class HybridTransformerStrategy {\n    private readonly lookbackWindow = 30;\n    // Simulated \"Head\" weights for Self-Attention mechanism\n    private readonly attentionHeads = {\n        momentum: 0.35, // High internal attention on RSI/MACD\n        volatility: 0.25, // Attention on Bollinger Bands\n        volume: 0.20, // Attention on Volume flow\n        trend: 0.20, // Attention on Moving Averages\n    };\n\n    /**\n     * Core \"Forward Pass\" of the evolved logic.\n     * Simulates a single-layer Attention mechanism on top of technical features.\n     */\n    public predict(\n        candles: CandlestickData[],\n        sentimentScore: number = 0.5 // Neutral default (0 = Bearish, 1 = Bullish)\n    ): PredictionResult {\n        if (candles.length < this.lookbackWindow) {\n            return { action: 'HOLD', confidence: 0, targetPrice: 0, reasoning: 'Insufficient Data' };\n        }\n\n        // 1. Feature Embedding (State Vector Construction)\n        const recentCandles = candles.slice(-this.lookbackWindow);\n        const indicators = calculateIndicators(recentCandles);\n        const lastPrice = recentCandles[recentCandles.length - 1].close;\n        \n        // Normalize Inputs (0-1 Scale)\n        const state: MarketStateVector = {\n            rsi: indicators.rsi / 100, // 0-1\n            macdHistogram: this.sigmoid(indicators.macd.histogram), // 0-1\n            volatility: (indicators.bollingerBands.upper - indicators.bollingerBands.lower) / lastPrice,\n            trendStrength: this.calculateTrendStrength(indicators, lastPrice),\n            volumeFlow: indicators.volumeAvg > 0 ? (recentCandles[recentCandles.length - 1].volume || 0) / indicators.volumeAvg : 1\n        };\n\n        // 2. Multi-Head Self-Attention Simulation\n        // In a real Transformer, this would be Q*K^T * V. Here we simulate the weighted aggregation.\n        const momentumScore = (state.rsi * 0.5 + state.macdHistogram * 0.5);\n        const trendScore = state.trendStrength;\n        const volScore = 1 - Math.min(state.volatility * 10, 1); // Lower volatility is often better for steady trends, or high for breakouts.\n        \n        // Dynamic Attention Adjustment based on Market Regime (SOTA concept: Adaptive Gating)\n        let dynamicWeights = { ...this.attentionHeads };\n        if (state.volatility > 0.05) {\n            // High volatility regime: Shift attention to Volatility and Momentum\n            dynamicWeights.volatility += 0.2;\n            dynamicWeights.trend -= 0.2;\n        }\n\n        // 3. Final Aggregation (Context Vector)\n        const contextScore = \n            (momentumScore * dynamicWeights.momentum) +\n            (trendScore * dynamicWeights.trend) +\n            (volScore * dynamicWeights.volatility) +\n            (Math.min(state.volumeFlow, 2) * 0.1 * dynamicWeights.volume); // Cap volume impact\n\n        // 4. Multi-modal Fusion\n        // Fusing Time-Series Context with Sentiment (e.g., News/Social)\n        // Formula: Final_Logit = alpha * Context + beta * Sentiment\n        const alpha = 0.7;\n        const beta = 0.3;\n        const finalLogit = (contextScore * alpha) + (sentimentScore * beta);\n\n        // 5. Decision Logic (Softmax-like thresholding)\n        return this.generateDecision(finalLogit, lastPrice, state);\n    }\n\n    private sigmoid(t: number): number {\n        return 1 / (1 + Math.exp(-t));\n    }\n\n    private calculateTrendStrength(ind: TechnicalIndicators, price: number): number {\n        let score = 0;\n        if (price > ind.sma20) score += 0.3;\n        if (ind.sma20 > ind.sma50) score += 0.3;\n        if (ind.sma50 > ind.sma200) score += 0.4;\n        return score;\n    }\n\n    private generateDecision(logit: number, currentPrice: number, state: MarketStateVector): PredictionResult {\n        // Logit is roughly 0 to 1, centered around 0.5\n        let action: 'BUY' | 'SELL' | 'HOLD' = 'HOLD';\n        let targetPrice = currentPrice;\n        \n        if (logit > 0.65) {\n            action = 'BUY';\n            targetPrice = currentPrice * (1 + (logit - 0.5) * 0.1); // Dynamic target based on conviction\n        } else if (logit < 0.35) {\n            action = 'SELL';\n            targetPrice = currentPrice * (1 - (0.5 - logit) * 0.1);\n        }\n\n        // Explanation Generation (XAI - Explainable AI)\n        const reasoning = `Score: ${logit.toFixed(3)} | RSI contribution: ${state.rsi.toFixed(2)} | Trend: ${state.trendStrength.toFixed(2)}`;\n\n        return {\n            action,\n            confidence: Math.abs(logit - 0.5) * 2, // 0 to 1\n            targetPrice,\n            reasoning\n        };\n    }\n}",
        "learning_rate": 0.001,
        "strategy": "Hybrid-Transformer-v1"
    },
    "backtest_report": "Simulation Result (365 Days): ROI 5.35% | MDD 100.00% (Cash Resets) | Trades: 19 | Strategy: Hybrid Attention Mechanism"
}